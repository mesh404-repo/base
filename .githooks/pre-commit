#!/bin/bash
# Pre-commit hook: Run py_compile on all Python files to catch syntax errors

set -e

echo "Running Python syntax check..."

# Find all staged Python files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$' || true)

if [ -z "$STAGED_FILES" ]; then
    echo "No Python files to check."
    exit 0
fi

# Check each file with py_compile
ERRORS=0
for file in $STAGED_FILES; do
    if [ -f "$file" ]; then
        if ! python3 -m py_compile "$file" 2>&1; then
            echo "Syntax error in: $file"
            ERRORS=1
        fi
    fi
done

if [ $ERRORS -ne 0 ]; then
    echo ""
    echo "Pre-commit check FAILED: Fix syntax errors before committing."
    exit 1
fi

echo "All Python files passed syntax check."
exit 0
